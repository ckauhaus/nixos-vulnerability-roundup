# Vulnerability roundup 112: envoy-1.17.3: 7 advisories [9.8]

[search](https://search.nix.gsc.io/?q=envoy&i=fosho&repos=NixOS-nixpkgs), [files](https://github.com/NixOS/nixpkgs/search?utf8=%E2%9C%93&q=envoy+in%3Apath&type=Code)

* [ ] [CVE-2022-21654](https://nvd.nist.gov/vuln/detail/CVE-2022-21654) CVSSv3=9.8 (nixos-21.11)
* [ ] [CVE-2021-43824](https://nvd.nist.gov/vuln/detail/CVE-2021-43824) CVSSv3=7.5 (nixos-21.11)
* [ ] [CVE-2021-43825](https://nvd.nist.gov/vuln/detail/CVE-2021-43825) CVSSv3=7.5 (nixos-21.11)
* [ ] [CVE-2021-43826](https://nvd.nist.gov/vuln/detail/CVE-2021-43826) CVSSv3=7.5 (nixos-21.11)
* [ ] [CVE-2022-21655](https://nvd.nist.gov/vuln/detail/CVE-2022-21655) CVSSv3=7.5 (nixos-21.11)
* [ ] [CVE-2022-21657](https://nvd.nist.gov/vuln/detail/CVE-2022-21657) CVSSv3=6.5 (nixos-21.11)
* [ ] [CVE-2022-21656](https://nvd.nist.gov/vuln/detail/CVE-2022-21656) CVSSv3=5.9 (nixos-21.11)

## CVE details

### CVE-2022-21654

Envoy is an open source edge and service proxy, designed for cloud-native applications. Envoy's tls allows re-use when some cert validation settings have changed from their default configuration. The only workaround for this issue is to ensure that default tls settings are used. Users are advised to upgrade.

### CVE-2021-43824

Envoy is an open source edge and service proxy, designed for cloud-native applications. In affected versions a crafted request crashes Envoy when a CONNECT request is sent to JWT filter configured with regex match. This provides a denial of service attack vector. The only workaround is to not use regex in the JWT filter. Users are advised to upgrade.

### CVE-2021-43825

Envoy is an open source edge and service proxy, designed for cloud-native applications. Sending a locally generated response must stop further processing of request or response data. Envoy tracks the amount of buffered request and response data and aborts the request if the amount of buffered data is over the limit by sending 413 or 500 responses. However when the buffer overflows while response is processed by the filter chain the operation may not be aborted correctly and result in accessing a freed memory block. If this happens Envoy will crash resulting in a denial of service.

### CVE-2021-43826

Envoy is an open source edge and service proxy, designed for cloud-native applications. In affected versions of Envoy a crash occurs when configured for :ref:`upstream tunneling <envoy_v3_api_field_extensions.filters.network.tcp_proxy.v3.TcpProxy.tunneling_config>` and the downstream connection disconnects while the the upstream connection or http/2 stream is still being established. There are no workarounds for this issue. Users are advised to upgrade.

### CVE-2022-21655

Envoy is an open source edge and service proxy, designed for cloud-native applications. The envoy common router will segfault if an internal redirect selects a route configured with direct response or redirect actions. This will result in a denial of service. As a workaround turn off internal redirects if direct response entries are configured on the same listener.

### CVE-2022-21657

Envoy is an open source edge and service proxy, designed for cloud-native applications. In affected versions Envoy does not restrict the set of certificates it accepts from the peer, either as a TLS client or a TLS server, to only those certificates that contain the necessary extendedKeyUsage (id-kp-serverAuth and id-kp-clientAuth, respectively). This means that a peer may present an e-mail certificate (e.g. id-kp-emailProtection), either as a leaf certificate or as a CA in the chain, and it will be accepted for TLS. This is particularly bad when combined with the issue described in pull request #630, in that it allows a Web PKI CA that is intended only for use with S/MIME, and thus exempted from audit or supervision, to issue TLS certificates that will be accepted by Envoy. As a result Envoy will trust upstream certificates that should not be trusted. There are no known workarounds to this issue. Users are advised to upgrade.

### CVE-2022-21656

Envoy is an open source edge and service proxy, designed for cloud-native applications. The default_validator.cc implementation used to implement the default certificate validation routines has a "type confusion" bug when processing subjectAltNames. This processing allows, for example, an rfc822Name or uniformResourceIndicator to be authenticated as a domain name. This confusion allows for the bypassing of nameConstraints, as processed by the underlying OpenSSL/BoringSSL implementation, exposing the possibility of impersonation of arbitrary servers. As a result Envoy will trust upstream certificates that should not be trusted.

-----
Scanned versions: nixos-21.11: efea022d6fe.

Cc @lukegb

