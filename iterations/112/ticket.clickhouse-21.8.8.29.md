# Vulnerability roundup 112: clickhouse-21.8.8.29: 7 advisories [8.8]

[search](https://search.nix.gsc.io/?q=clickhouse&i=fosho&repos=NixOS-nixpkgs), [files](https://github.com/NixOS/nixpkgs/search?utf8=%E2%9C%93&q=clickhouse+in%3Apath&type=Code)

* [ ] [CVE-2021-43304](https://nvd.nist.gov/vuln/detail/CVE-2021-43304) CVSSv3=8.8 (nixos-21.11)
* [ ] [CVE-2021-43305](https://nvd.nist.gov/vuln/detail/CVE-2021-43305) CVSSv3=8.8 (nixos-21.11)
* [ ] [CVE-2021-42387](https://nvd.nist.gov/vuln/detail/CVE-2021-42387) CVSSv3=8.1 (nixos-21.11)
* [ ] [CVE-2021-42388](https://nvd.nist.gov/vuln/detail/CVE-2021-42388) CVSSv3=8.1 (nixos-21.11)
* [ ] [CVE-2021-42389](https://nvd.nist.gov/vuln/detail/CVE-2021-42389) CVSSv3=6.5 (nixos-21.11)
* [ ] [CVE-2021-42390](https://nvd.nist.gov/vuln/detail/CVE-2021-42390) CVSSv3=6.5 (nixos-21.11)
* [ ] [CVE-2021-42391](https://nvd.nist.gov/vuln/detail/CVE-2021-42391) CVSSv3=6.5 (nixos-21.11)

## CVE details

### CVE-2021-43304

Heap buffer overflow in Clickhouse's LZ4 compression codec when parsing a malicious query. There is no verification that the copy operations in the LZ4::decompressImpl loop and especially the arbitrary copy operation wildCopy<copy_amount>(op, ip, copy_end), don’t exceed the destination buffer’s limits.

### CVE-2021-43305

Heap buffer overflow in Clickhouse's LZ4 compression codec when parsing a malicious query. There is no verification that the copy operations in the LZ4::decompressImpl loop and especially the arbitrary copy operation wildCopy<copy_amount>(op, ip, copy_end), don’t exceed the destination buffer’s limits. This issue is very similar to CVE-2021-43304, but the vulnerable copy operation is in a different wildCopy call.

### CVE-2021-42387

Heap out-of-bounds read in Clickhouse's LZ4 compression codec when parsing a malicious query. As part of the LZ4::decompressImpl() loop, a 16-bit unsigned user-supplied value ('offset') is read from the compressed data. The offset is later used in the length of a copy operation, without checking the upper bounds of the source of the copy operation.

### CVE-2021-42388

Heap out-of-bounds read in Clickhouse's LZ4 compression codec when parsing a malicious query. As part of the LZ4::decompressImpl() loop, a 16-bit unsigned user-supplied value ('offset') is read from the compressed data. The offset is later used in the length of a copy operation, without checking the lower bounds of the source of the copy operation.

### CVE-2021-42389

Divide-by-zero in Clickhouse's Delta compression codec when parsing a malicious query. The first byte of the compressed buffer is used in a modulo operation without being checked for 0.

### CVE-2021-42390

Divide-by-zero in Clickhouse's DeltaDouble compression codec when parsing a malicious query. The first byte of the compressed buffer is used in a modulo operation without being checked for 0.

### CVE-2021-42391

Divide-by-zero in Clickhouse's Gorilla compression codec when parsing a malicious query. The first byte of the compressed buffer is used in a modulo operation without being checked for 0.

-----
Scanned versions: nixos-21.11: efea022d6fe.

Cc @orivej

